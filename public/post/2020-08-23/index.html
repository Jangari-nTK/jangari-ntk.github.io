
<!DOCTYPE html>
<html
  lang="en"
  data-figures=""
  
    class="page"
  
  
  >
  <head><script src="/livereload.js?mindelay=10&amp;v=2&amp;port=1313&amp;path=livereload" data-no-instant defer></script>
<title>Nested ESXi のテンプレート作りに必要な設定と解説 | My New Hugo Site</title>
<meta charset="utf-8">

<meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
<meta http-equiv="X-UA-Compatible" content="IE=edge">


  
<meta property="og:locale" content="en" />

<meta property="og:type" content="article">
<meta name="description" content="みなさん Nested ESXi、使ってますか？vSphere の学習や実験にとても便利ですよね。" />
<meta name="twitter:card" content="summary" />
<meta name="twitter:creator" content="">
<meta name="twitter:title" content="Nested ESXi のテンプレート作りに必要な設定と解説" />
<meta name="twitter:image" content="http://localhost:1313/images/building.png"/>
<meta property="og:url" content="http://localhost:1313/post/2020-08-23/" />
<meta property="og:title" content="Nested ESXi のテンプレート作りに必要な設定と解説" />
<meta property="og:description" content="みなさん Nested ESXi、使ってますか？vSphere の学習や実験にとても便利ですよね。" />
<meta property="og:image" content="http://localhost:1313/images/building.png" />
  <meta name="keywords" content="Tips,ESXi,vSphere,Nested" />

<link rel="apple-touch-icon" sizes="180x180" href="http://localhost:1313/icons/apple-touch-icon.png">
<link rel="icon" type="image/png" sizes="32x32" href="http://localhost:1313/icons/favicon-32x32.png">
<link rel="manifest" href="http://localhost:1313/icons/site.webmanifest">

<link rel="canonical" href="http://localhost:1313/post/2020-08-23/">



<link rel="preload" href="http://localhost:1313/css/styles.dc38388a8f0b890e788bd3a99b7495d14e7d5ac4359ed3b49abeb778497863b284ad4cc7e496ef58c84139295f9bafed82f5a41345eda86bd2d429cccb7c2596.css" integrity = "sha512-3Dg4io8LiQ54i9Opm3SV0U59WsQ1ntO0mr63eEl4Y7KErUzH5JbvWMhBOSlfm6/tgvWkE0XtqGvS1CnMy3wllg==" as="style" crossorigin="anonymous">



<link rel="preload" href="http://localhost:1313/en/js/bundle.84e7640170829f904da39c3d23a2c4064096bd26b37eca6f71d955e2d668377185b71761a1e9b7742b677b7bfba71d4b863f4d54a152f0bb480ab6ade26df8c8.js" as="script" integrity=
"sha512-hOdkAXCCn5BNo5w9I6LEBkCWvSazfspvcdlV4tZoN3GFtxdhoem3dCtne3v7px1Lhj9NVKFS8LtICrat4m34yA==" crossorigin="anonymous">


<link rel="stylesheet" type="text/css" href="http://localhost:1313/css/styles.dc38388a8f0b890e788bd3a99b7495d14e7d5ac4359ed3b49abeb778497863b284ad4cc7e496ef58c84139295f9bafed82f5a41345eda86bd2d429cccb7c2596.css" integrity="sha512-3Dg4io8LiQ54i9Opm3SV0U59WsQ1ntO0mr63eEl4Y7KErUzH5JbvWMhBOSlfm6/tgvWkE0XtqGvS1CnMy3wllg==" crossorigin="anonymous">

  </head>
  <body
    data-code="100"
    data-lines="false"
    id="documentTop"
    data-lang="en"
  >

<header class="nav_header" >
  <nav class="nav"><a href='http://localhost:1313/' class="nav_brand nav_item" title="My New Hugo Site">My New Hugo Site
  <div class="nav_close">
    <div><svg class="icon">
  <title>open-menu</title>
  <use xlink:href="#open-menu"></use>
</svg>
<svg class="icon">
  <title>closeme</title>
  <use xlink:href="#closeme"></use>
</svg>
</div>
  </div>
</a>

    <div class='nav_body nav_body_left'>
      
      
      
        

      
<div class='follow'>
<div class="color_mode">
  <input type="checkbox" class="color_choice" id="mode">
</div>

</div>

    </div>
  </nav>
</header>

    <main>
  
<div class="grid-inverse wrap content">
  <article class="post_content">
    <h1 class="post_title">Nested ESXi のテンプレート作りに必要な設定と解説</h1>
  <div class="post_meta">
    <span><svg class="icon">
  <title>calendar</title>
  <use xlink:href="#calendar"></use>
</svg>
</span>
    <span class="post_date">
      Aug 23, 2020	  
    </span>
    <span class="post_time"> · 6 min read</span><span>&nbsp;· <a href='http://localhost:1313/tags/tips/' title="Tips" class="post_tag button button_translucent">Tips
        </a><a href='http://localhost:1313/tags/esxi/' title="ESXi" class="post_tag button button_translucent">ESXi
        </a><a href='http://localhost:1313/tags/vsphere/' title="vSphere" class="post_tag button button_translucent">vSphere
        </a><a href='http://localhost:1313/tags/nested/' title="Nested" class="post_tag button button_translucent">Nested
        </a>
    </span>
    <span class="page_only">&nbsp;·
  <div class="post_share">
    Share on:
    <a href="https://twitter.com/intent/tweet?text=Nested%20ESXi%20%e3%81%ae%e3%83%86%e3%83%b3%e3%83%97%e3%83%ac%e3%83%bc%e3%83%88%e4%bd%9c%e3%82%8a%e3%81%ab%e5%bf%85%e8%a6%81%e3%81%aa%e8%a8%ad%e5%ae%9a%e3%81%a8%e8%a7%a3%e8%aa%ac&url=http%3a%2f%2flocalhost%3a1313%2fpost%2f2020-08-23%2f&tw_p=tweetbutton" class="twitter" title="Share on Twitter" target="_blank" rel="nofollow">
      <svg class="icon">
  <title>twitter</title>
  <use xlink:href="#twitter"></use>
</svg>

    </a>
    <a href="https://www.facebook.com/sharer.php?u=http%3a%2f%2flocalhost%3a1313%2fpost%2f2020-08-23%2f&t=Nested%20ESXi%20%e3%81%ae%e3%83%86%e3%83%b3%e3%83%97%e3%83%ac%e3%83%bc%e3%83%88%e4%bd%9c%e3%82%8a%e3%81%ab%e5%bf%85%e8%a6%81%e3%81%aa%e8%a8%ad%e5%ae%9a%e3%81%a8%e8%a7%a3%e8%aa%ac" class="facebook" title="Share on Facebook" target="_blank" rel="nofollow">
      <svg class="icon">
  <title>facebook</title>
  <use xlink:href="#facebook"></use>
</svg>

    </a>
    <a href="#linkedinshare" id = "linkedinshare" class="linkedin" title="Share on LinkedIn" rel="nofollow">
      <svg class="icon">
  <title>linkedin</title>
  <use xlink:href="#linkedin"></use>
</svg>

    </a>
    <a href="http://localhost:1313/post/2020-08-23/" title="Copy Link" class="link link_yank">
      <svg class="icon">
  <title>copy</title>
  <use xlink:href="#copy"></use>
</svg>

    </a>
  </div>
  </span>
  </div>

      <div class="post_toc">
        <h2>Overview</h2>
        <nav id="TableOfContents">
  <ul>
    <li><a href="#20210822-追記esxi-70-u2-以降では安全なブート領域の複製が不可">2021/08/22 追記：ESXi 7.0 U2 以降では安全なブート領域の複製が不可</a></li>
    <li><a href="#はじめに">はじめに</a></li>
    <li><a href="#仮想マシンの作成">仮想マシンの作成</a>
      <ul>
        <li><a href="#ゲストosの種類に-vmware-esxi-65-以降を選択">ゲストOSの種類に VMware ESXi 6.5 以降を選択</a></li>
        <li><a href="#intel-vt-x--amd-v-をゲストosが使えるように設定">Intel VT-x / AMD-V をゲストOSが使えるように設定</a></li>
        <li><a href="#起動時に-bios--efi-のセットアップ画面の強制">起動時に BIOS / EFI のセットアップ画面の強制</a></li>
      </ul>
    </li>
    <li><a href="#nested-esxi-のインストール">Nested ESXi のインストール</a>
      <ul>
        <li><a href="#esxi-70-でサポート外-cpu-を許可する">ESXi 7.0 でサポート外 CPU を許可する</a></li>
      </ul>
    </li>
    <li><a href="#nested-esxi-のインストール後">Nested ESXi のインストール後</a>
      <ul>
        <li><a href="#再esxi-70-でサポート外-cpu-を許可する">再・ESXi 7.0 でサポート外 CPU を許可する</a></li>
        <li><a href="#esxi-shell-と-ssh-の有効化">ESXi Shell と SSH の有効化</a></li>
        <li><a href="#esxi-70-でサポート外-cpu-を許可する設定の永続化">ESXi 7.0 でサポート外 CPU を許可する設定の永続化</a></li>
        <li><a href="#vmk0-の仮想-mac-アドレスを-vnic-に追従させる">vmk0 の仮想 MAC アドレスを vNIC に追従させる</a></li>
        <li><a href="#追加の-vmkernel-ポートは作成しない">追加の VMkernel ポートは作成しない</a></li>
        <li><a href="#番外-vmware-tools-for-nested-esxi">番外： VMware Tools for Nested ESXi</a></li>
        <li><a href="#vmfs-データストアの削除">VMFS データストアの削除</a></li>
        <li><a href="#番外-diskenableuuid-と-vmfs-の再署名">番外: disk.enableUUID と VMFS の再署名</a></li>
        <li><a href="#esxconf-内の-system-uuid-の削除">esx.conf 内の System UUID の削除</a></li>
      </ul>
    </li>
    <li><a href="#仮想マシンテンプレートへの変換">仮想マシンテンプレートへの変換</a></li>
    <li><a href="#ホスト側の-esxi-での設定変更">ホスト側の ESXi での設定変更</a>
      <ul>
        <li><a href="#偽装転送プロミスキャスモードを許可">偽装転送＆プロミスキャスモードを許可</a></li>
        <li><a href="#偽装転送を許可-vds-66-以降の-mac-ラーニングを使う">偽装転送を許可＆ vDS 6.6 以降の MAC ラーニングを使う</a></li>
      </ul>
    </li>
    <li><a href="#おわりに">おわりに</a></li>
  </ul>
</nav>
      </div>
    
    <div class="post_body"><h2 id="20210822-追記esxi-70-u2-以降では安全なブート領域の複製が不可">2021/08/22 追記：ESXi 7.0 U2 以降では安全なブート領域の複製が不可</h2>
<blockquote class="twitter-tweet"><p lang="ja" dir="ltr">Nested ESXi のクローン、ESXi 7.0 U2 以降は完全に終了みたい。多分 configstore 周りの変更とかだろうなぁ・・・<br><br>After upgrading to ESXi 7.0U2, corruption can occur on VMFS datastores if the ESXi hosts sharing those LUNs had their boot devices cloned (84349)<a href="https://t.co/mJOY0iPvc8">https://t.co/mJOY0iPvc8</a></p>&mdash; Jangari (@Jangari_nTK) <a href="https://twitter.com/Jangari_nTK/status/1422894456567595015?ref_src=twsrc%5Etfw">August 4, 2021</a></blockquote>
<script async src="https://platform.twitter.com/widgets.js" charset="utf-8"></script>


<p>ESXi 7.0 Update 2 以降では ESXi の UUID への依存関係が増えているようで、esx.conf 内の UUID の修正のみでは足りなくなったようで、安全なブート領域のクローンが行えなくなりました。</p>
<ul>
<li>
<p><a href="https://williamlam.com/2013/12/how-to-properly-clone-nested-esxi-vm.html">How to properly clone a Nested ESXi VM? - WilliamLam.com</a></p>
<blockquote>
<p>UPDATE (07/01/21) - As of ESXi 7.0 Update 2, cloning an ESXi boot volume (Nested or Physical) is no longer safe and can lead to data corruption. Please refer to the following two VMware KB articles for more information on this topic <a href="https://kb.vmware.com/kb/84280">https://kb.vmware.com/kb/84280</a> and <a href="https://kb.vmware.com/kb/84349">https://kb.vmware.com/kb/84349</a></p></blockquote>
</li>
<li>
<p><a href="https://kb.vmware.com/s/article/84280">Statement about supportability of cloning ESXi boot devices for deployments (84280)</a></p>
</li>
<li>
<p><a href="https://kb.vmware.com/s/article/84349">After upgrading to ESXi 7.0U2, corruption can occur on VMFS datastores if the ESXi hosts sharing those LUNs had their boot devices cloned (84349)</a></p>
</li>
</ul>
<p>元々 ESXi のブート領域の複製自体がサポートされない操作ですが、ESXi 7.0 Update 2 以降では同一 UUID を持つ(持っていた) ESXi から VMFS を共有すると VMFS が破損する可能性があるそうです。</p>
<p>ESXi 7.0 Update 2 以降のリリースは正規の手順で新規インストールすることが対応方法です。Nested ESXi なら TPM 等も無いので Configuration Reset の後に再設定でも良いような気はしますが、Kickstart スクリプトで自動インストールするなど正規の手順を踏むのが良いとは思います。</p>
<p>以降は ESXi 7.0 Update 1 以前の Nested ESXi 用の手順です。ESXi 7.0 Update 2 以降は対象としませんのでご注意ください。また、間違っても本番環境で同様の手順は実施しないようお願いします。</p>
<h2 id="はじめに">はじめに</h2>
<p>みなさん Nested ESXi、使ってますか？vSphere の学習や実験にとても便利ですよね。</p>
<p>最近は Nested ESXi の作り方を Google 検索で調べれば日本語の情報も出てきますし、中の人も<a href="https://www.virtuallyghetto.com/nested-virtualization">各種 Tips</a> や <a href="https://www.virtuallyghetto.com/nested-virtualization/nested-esxi-virtual-appliance">OVF テンプレート／コンテンツライブラリの URL</a>まで公開してくれています。</p>
<p>そこで、今回はある程度クリーンな Nested ESXi 7.0 のテンプレートを作るために必要な設定と、その設定の詳細について少し踏み込んで見ていきたいと思います。</p>
<h2 id="仮想マシンの作成">仮想マシンの作成</h2>
<p>仮想マシンの作成時のポイントとしては3つほどあります。</p>
<h3 id="ゲストosの種類に-vmware-esxi-65-以降を選択">ゲストOSの種類に VMware ESXi 6.5 以降を選択</h3>
<p>仮想マシンの作成時にゲストOSの種類として [VMware ESXi 6.5 以降] を選択することで、2 CPU、4GB メモリ、VMXNET3、PVSCSI が自動的に選択されるようになっています。選択したゲストOSの種類に応じた仮想ハードウェア構成がプリセットとして選択されるので、Nested ESXi に限らず、仮想マシンの作成時に正しいゲストOSを選択することはとても重要です。</p>
<p>なお、VMXNET3 ドライバは ESXi 5.1 時代から、PVSCSI ドライバは ESXi 6.5 から ESXi 自身のモジュールとして組み込まれています。</p>
<ul>
<li><a href="https://www.virtuallyghetto.com/2012/09/nested-esxi-51-supports-vmxnet3-network.html">Nested ESXi 5.1 Supports VMXNET3 Network Adapter Type</a></li>
<li><a href="https://www.virtuallyghetto.com/2016/10/nested-esxi-enhancements-in-vsphere-6-5.html">Nested ESXi Enhancements in vSphere 6.5</a></li>
</ul>
<p>また、ESXi 6.7 Update 2 では Nested ESXi 向けの Intel DPDK 対応(Poll Mode Driver)のドライバ(nvmxnet3_ens)も追加されていたりします。NSX-T で N-VDS / VDS を拡張データパスで構成するとこちらのドライバに切り替わります。</p>
<ul>
<li><a href="https://www.virtuallyghetto.com/2019/12/configure-nsx-t-enhanced-data-path-network-stack-ens-for-nested-esxi.html">Configure NSX-T Enhanced Data path / Network Stack (ENS) for Nested ESXi</a></li>
<li><a href="https://docs.vmware.com/jp/VMware-NSX-T-Data-Center/3.0/installation/GUID-F459E3E4-F5F2-4032-A723-07D4051EFF8D.html">拡張データ パス</a></li>
</ul>
<h3 id="intel-vt-x--amd-v-をゲストosが使えるように設定">Intel VT-x / AMD-V をゲストOSが使えるように設定</h3>
<p>仮想ハードウェアの CPU の設定で [ハードウェア アシストによる仮想化をゲスト OS に公開] にチェックを入れます。これによりゲストOSでも Intel VT-x / AMD-V による CPU 仮想化支援が利用できるようになります。最近では Windows 10 の Virtualization-Based Security を ESXi 上の仮想マシンでサポート (実質 Nested Hyper-V を実行) するために使用されたりもします。</p>
<ul>
<li><a href="https://docs.vmware.com/jp/VMware-vSphere/7.0/com.vmware.vsphere.vm_admin.doc/GUID-2A98801C-68E8-47AF-99ED-00C63E4857F6.html">VMware ハードウェア アシストによる仮想化の公開</a></li>
<li><a href="https://docs.vmware.com/jp/VMware-vSphere/7.0/com.vmware.vsphere.security.doc/GUID-68126448-37D9-4775-9326-2E0B9C9BB5E7.html">仮想化ベース セキュリティによる Windows ゲスト OS の保護</a></li>
</ul>
<p>こちらの設定を有効にしなくても ESXi のインストールは可能ですが、インストールの中で CPU 仮想化支援が無効な旨の警告が出たり、インストール後に 64bit OS が起動できないなどの問題が発生します。後から都度設定するのも面倒ですので仮想マシンテンプレートの作成時点で有効にしておきましょう。</p>
<p><a href="https://www.virtuallyghetto.com/2011/07/how-to-enable-support-for-nested-64bit.html">How to Enable Support for Nested 64bit &amp; Hyper-V VMs in vSphere 5</a></p>
<h3 id="起動時に-bios--efi-のセットアップ画面の強制">起動時に BIOS / EFI のセットアップ画面の強制</h3>
<p>仮想マシンオプションの [起動オプション] で [次回起動時に、強制的に EFI セットアップ画面に入る] にチェックを入れます。これにより一度だけパワーオン後に何もしなくても EFI の画面が表示されるので、慌てて DEL キーを連打しなくて済みます。</p>
<p><a href="https://docs.vmware.com/jp/VMware-vSphere/7.0/com.vmware.vsphere.vm_admin.doc/GUID-EAAE9426-D08E-4DF1-820B-7C022C2A85FA.html">起動シーケンスの遅延</a></p>
<p>初回インストールでデータストアから ISO をマウントする場合は不要ですが、VMRC からローカルの ISO をマウントする、ESXi を再インストールする場合には有効にしておきましょう。</p>
<h2 id="nested-esxi-のインストール">Nested ESXi のインストール</h2>
<p>ESXi のインストール時は、かなり限定された環境の場合に1点あります。</p>
<h3 id="esxi-70-でサポート外-cpu-を許可する">ESXi 7.0 でサポート外 CPU を許可する</h3>
<p>ESXi 7.0 ではサポートされない CPU (特に Westmere 以前) を使用する構成では警告が出てインストールが継続できなくなっています。このため、ESXi のインストーラ起動前に ESXi のブートローダ画面で Shift + O を押下して、allowLegacyCPU=true の起動オプションを追加してから起動する必要があります。</p>
<ul>
<li><a href="https://www.virtuallyghetto.com/2020/04/quick-tip-allow-unsupported-cpus-when-upgrading-to-esxi-7-0.html">Quick Tip – Allow unsupported CPUs when upgrading to ESXi 7.0</a></li>
</ul>
<p>ブートローダでの起動オプションは、本来は以下のように Kickstart スクリプト (ks.cfg) を指定する場合などに使います。</p>
<ul>
<li><a href="https://docs.vmware.com/jp/VMware-vSphere/7.0/com.vmware.esxi.install.doc/GUID-A33C4CAB-18EE-4C8C-A55D-8AD7E8042BFA.html">インストール スクリプトまたはアップグレード スクリプトを開始するための起動オプションの入力</a></li>
</ul>
<p>なお、ESXi 7.0 でサポートされている CPU を使用している、ESXi 6.7 以前の場合は本設定は不要です。</p>
<h2 id="nested-esxi-のインストール後">Nested ESXi のインストール後</h2>
<p>Nested ESXi のインストール後に必要になる設定はかなり多いです。</p>
<h3 id="再esxi-70-でサポート外-cpu-を許可する">再・ESXi 7.0 でサポート外 CPU を許可する</h3>
<p>allowLegacyCPU=true はブートローダで指定した場合は設定が永続化されないため、ESXi のインストール後、最初の起動時にも同様にブートローダで同じオプションを追加して ESXi を起動します。</p>
<p><a href="https://www.virtuallyghetto.com/2020/04/quick-tip-allow-unsupported-cpus-when-upgrading-to-esxi-7-0.html">Quick Tip – Allow unsupported CPUs when upgrading to ESXi 7.0</a></p>
<h3 id="esxi-shell-と-ssh-の有効化">ESXi Shell と SSH の有効化</h3>
<p>DCUI で F2 を押下してシステム構成画面に入り、[Troubleshooting Options] から ESXi Shell と SSH を有効にしておきます。</p>
<p><a href="https://docs.vmware.com/jp/VMware-vSphere/7.0/com.vmware.esxi.install.doc/GUID-F9234F4A-FD6A-477B-B7BA-28EB6B08CE82.html">ダイレクト コンソール ユーザー インターフェイスを使用した、ESXi Shell および SSH アクセスの有効化</a></p>
<p>なお、あくまでも Nested ESXi は検証用として使うためにシェルを有効にしています。セキュリティの観点から通常運用時はどちらも無効が推奨ですので、本番環境ではトラブルシューティング時のみ有効にして使うようにしましょう。</p>
<h3 id="esxi-70-でサポート外-cpu-を許可する設定の永続化">ESXi 7.0 でサポート外 CPU を許可する設定の永続化</h3>
<p>bootbank 内の boot.cfg の kernelopts 行に起動オプションが記載されているため、こちらに allowLegacyCPU=true を追記します。DCUI で Alt + F1 を押下して ESXi Shell に root でログインし、vi で /bootbank/boot.cfg を編集します。これで ESXi の再起動後も設定が保持されます。</p>
<p><a href="https://www.virtuallyghetto.com/2020/04/quick-tip-allow-unsupported-cpus-when-upgrading-to-esxi-7-0.html">Quick Tip – Allow unsupported CPUs when upgrading to ESXi 7.0</a></p>
<p>なお、bootbank と altbootbank には ESXi のブートイメージや構成情報が格納されています。こちらが破損すると ESXi が起動しなくなるため、通常運用時はテクニカルサポートからの特別な指示でも無い限り決して触ってはいけません。</p>
<h3 id="vmk0-の仮想-mac-アドレスを-vnic-に追従させる">vmk0 の仮想 MAC アドレスを vNIC に追従させる</h3>
<p>仮想マシンをクローンすると vNIC には新しい仮想 MAC アドレスが割り当てられます。しかし、ESXi では VMkernel ポートに仮想 MAC アドレスがソフトウェア的に割り当てられています。このため、Nested ESXi をクローンしても仮想 MAC アドレスは変更されず、Nested ESXi 間で同じ MAC アドレスの VMkernel ポートが重複してしまいます。</p>
<p>そこで ESXi Shell から /Net/FollowHardwareMac の設定を有効にすることで、仮想マシンの vNIC に vmk0 (管理ネットワークの VMkernel ポート) の仮想 MAC アドレスを追従させる設定を施します。これにより vmnic の MAC アドレスが変更されると vmk0 の MAC アドレスも更新されるようになります。</p>
<pre tabindex="0"><code># esxcli system settings advanced set -o /Net/FollowHardwareMac -i 1
</code></pre><p>なお、こちらの設定は KB1031111 に記載があります。Details を読む限り、ESXi の起動ディスクを複製して別のサーバに搭載する、インストール済み ESXi の物理 NIC (MAC アドレス) を別のサーバに使い回した上で ESXi を再インストールする、といった作業を行うと問題として顕在化する可能性があるようです。このため物理環境では極めて限定的な状況下でのみ必要となる印象です。</p>
<p><a href="https://kb.vmware.com/s/article/1031111?lang=ja">NIC カードを交換しても vmk0 管理ネットワークの MAC アドレスが更新されないか、vmkernel に重複する MAC アドレスが存在する (1031111)</a></p>
<h3 id="追加の-vmkernel-ポートは作成しない">追加の VMkernel ポートは作成しない</h3>
<p>/Net/FollowHardwareMac は管理ネットワークの VMkernel ポート (vmk0) だけに有効です。このため、本設定が有効でも他の VMkernel ポートの仮想 MAC アドレスはクローン後も変更されないため、Nested ESXi のテンプレートの時点では追加の VMkernel ポートは作成しないようにします。</p>
<h3 id="番外-vmware-tools-for-nested-esxi">番外： VMware Tools for Nested ESXi</h3>
<p>ESXi 6.0 以降では Nested ESXi 用の VMware Tools が ESXi に組み込まれています。ESXi 5.x を Nested ESXi として利用する場合は以下の Flings から VIB をダウンロードして ESXi にインストールする必要がありました。</p>
<ul>
<li><a href="https://flings.vmware.com/vmware-tools-for-nested-esxi">VMware Tools for Nested ESXi</a></li>
<li><a href="https://www.virtuallyghetto.com/2013/11/w00t-vmware-tools-for-nested-esxi.html">w00t! VMware Tools for Nested ESXi!</a></li>
</ul>
<p><a href="https://github.com/lamw/instantclone-community-customization-scripts/blob/master/esxi65-67/customize.sh">こちらの中の人のスクリプト</a>のように、VMware Tools 経由でホストから guestinfo 変数の取得などもできたりします。なお、物理サーバで実行される ESXi では VMware Tools for Nested ESXi は実行されません。</p>
<h3 id="vmfs-データストアの削除">VMFS データストアの削除</h3>
<p>VMFS は作成された時点で固有の UUID が割り当てられます。vCenter Server に ESXi を追加する際に同じ UUID のデータストアが既にインベントリに存在すると追加に失敗します。このため、Nested ESXi にローカルの VMFS データストアが存在する場合は事前に削除しておきましょう。</p>
<p>Nested ESXi の Host Client にログインし、左メニューの [ストレージ] &gt; [データストア] タブを開いてから、データストアを右クリックして削除するのが無難です。</p>
<p><a href="https://docs.vmware.com/jp/VMware-vSphere/7.0/com.vmware.vsphere.hostclient.doc/GUID-9F6662AE-5009-44FF-A7C0-113A78151458.html">VMware Host Client での VMFS データストアの削除</a></p>
<p>partedUtil コマンドを使用して VMFS のパーティション番号を確認して削除することも出来ます。ただ、間違って ESXi のパーティションを削除しないように注意が必要です。基本的にはトラブルシューティングのためのツールなので通常運用時はあまり使わないほうが良いと思います。</p>
<pre tabindex="0"><code># partedUtil getptbl /vmfs/devices/disks/&lt;起動ディスクのデバイス識別子&gt;
# partedUtil delete /vmfs/devices/disks/&lt;起動ディスクのデバイス識別子&gt; &lt;VMFS のパーティション番号&gt;
# services.sh restart
</code></pre><p>partedUtil コマンドの使用方法は KB1036609 に記載されています。</p>
<p><a href="https://kb.vmware.com/s/article/1036609">Using the partedUtil command line utility on ESXi and ESX (1036609)</a></p>
<h3 id="番外-diskenableuuid-と-vmfs-の再署名">番外: disk.enableUUID と VMFS の再署名</h3>
<p>データストアの削除以外に VMFS の UUID を重複させない方法として、仮想マシンの disk.enableUUID オプションとデータストアの再署名を併用する方法もあります。</p>
<p>まず、仮想マシンで disk.enableUUID のオプションを有効にすると仮想ディスクがデバイス固有の UUID (WWN / WWID) をゲストOSに見せるようになり、Nested ESXi 見えではデバイス識別子が mpx から naa に変わります。冒頭に記載した Nested ESXi の OVF テンプレートでも本設定が有効になっています。</p>
<ul>
<li><a href="https://www.virtuallyghetto.com/2015/12/deploying-nested-esxi-is-even-easier-now-with-the-esxi-virtual-appliance.html">Deploying Nested ESXi is even easier now with the ESXi Virtual Appliance</a></li>
<li><a href="https://kb.vmware.com/s/article/50121797">Listing LUN serial numbers on Windows Powershell 2016 (50121797)</a></li>
<li><a href="https://kb.vmware.com/s/article/1014953?lang=ja">VMware ESXi/ESX を操作するときのディスクの識別 (1014953)</a></li>
</ul>
<p>次に、この状態で仮想ディスクがクローンされると、クローンされたディスク上の VMFS は本来のデータストアではなくコピーされたデータストア (スナップショット LUN) として検出されます。この VMFS のコピーを ESXi でマウントするには、VMFS の再署名による UUID の再割り当てが必要となります。</p>
<ul>
<li><a href="https://docs.vmware.com/jp/VMware-vSphere/7.0/com.vmware.vsphere.storage.doc/GUID-EBAB0D5A-3C77-4A9B-9884-3D4AD69E28DC.html">重複 VMFS データストアの管理</a></li>
<li><a href="https://kb.vmware.com/s/article/1011387?lang=ja">スナップショット LUN として検出された vSphere の LUN 処理 (1011387)</a></li>
</ul>
<p>この性質を利用すると、disk.enableUUID が有効な Nested ESXi テンプレートからのデプロイ後にデータストアの再署名をおこなうことで、意図的に VMFS の UUID を再割り当てすることが出来ます。中の人のブログではこちらの方法で対応しているようです。</p>
<p><a href="virtuallyghetto.com/2013/12/how-to-properly-clone-nested-esxi-vm.html">How to properly clone a Nested ESXi VM?</a></p>
<p>なお、データストアの再署名はスナップショット LUN に対してのみ可能です。コピーされていない通常のデータストアはディスクと VMFS の情報に整合性が取れているため、データストアの再署名は必要がなく実施も出来ません。</p>
<h3 id="esxconf-内の-system-uuid-の削除">esx.conf 内の System UUID の削除</h3>
<p>ESXi は esxcli system uuid get コマンドで確認できる一意な UUID を持っています。vCenter Server はこの UUID で ESXi を識別しており、追加しようとする ESXi の UUID がインベントリ内の ESXi と競合すると追加に失敗したり不正な動作を起こしたりする場合があります。</p>
<p>このため、Nested ESXi のシャットダウン前の最後の作業として以下のコマンドを実行し、/etc/vmware/esx.conf に存在する UUID の行を削除します。vi による手動編集でも OK です。これにより次の ESXi の起動時、つまりテンプレートからのデプロイ後に ESXi の UUID が再生成されます。</p>
<pre tabindex="0"><code># sed -i &#39;s#/system/uuid.*##&#39; /etc/vmware/esx.conf
</code></pre><ul>
<li><a href="https://code.vmware.com/docs/6676/vsphere-command-line-interface-reference/doc/esxcli_system.html">esxcli system - vSphere Command-Line Interface Reference - VMware {code}</a></li>
<li><a href="https://www.virtuallyghetto.com/2013/12/how-to-properly-clone-nested-esxi-vm.html">How to properly clone a Nested ESXi VM?</a></li>
</ul>
<p>なお、esx.conf から UUID を削除した後に ESXi の再起動や esxcli system uuid get コマンドを実行すると UUID が再生成されてしまいます。このため、Nested ESXi のテンプレートのための作業が一通り終わってからシャットダウン前に実施するのが確実です。</p>
<h2 id="仮想マシンテンプレートへの変換">仮想マシンテンプレートへの変換</h2>
<p>ここまで Nested ESXi 仮想マシンでの作業が完了したら、あとは Nested ESXi をシャットダウンしてから仮想マシンテンプレートとしてクローンしておきましょう。もしくは、単に仮想マシンテンプレートに変換するだけでも OK です。</p>
<p><a href="https://docs.vmware.com/jp/VMware-vSphere/7.0/com.vmware.vsphere.vm_admin.doc/GUID-5B3737CC-28DB-4334-BD18-6E12011CDC9F.html">テンプレートへの仮想マシンのクローン作成</a></p>
<p>なお、仮想マシンテンプレートは vSphere Client (HTML5) 上で [仮想マシンおよびテンプレート] ビューから確認する必要があります。[ホストおよびクラスタ] ビューには表示されませんのでご注意ください。</p>
<p><a href="https://docs.vmware.com/jp/VMware-vSphere/7.0/com.vmware.vsphere.vcenterhost.doc/GUID-4D4B3DF2-D033-4782-A030-3C3600DE5A7F.html">vSphere が管理するインベントリ オブジェクト</a></p>
<h2 id="ホスト側の-esxi-での設定変更">ホスト側の ESXi での設定変更</h2>
<p>Nested ESXi をホストする ESXi では仮想スイッチで以下のどちらかの構成が必要になります。</p>
<h3 id="偽装転送プロミスキャスモードを許可">偽装転送＆プロミスキャスモードを許可</h3>
<p>Nested ESXi では、仮想マシンの vNIC の MAC アドレスとは異なる MAC アドレスが送信元や宛先に設定された Ethernet フレームが vNIC で送受信されることになります。</p>
<p>しかし、vNIC と異なる送信元 MAC アドレスのフレーム、つまり送信元 MAC アドレスをなりすましたフレームが送信された場合、既定では以下の「偽装転送」オプションにより仮想スイッチがフレームを破棄します。このため、Nested ESXi が接続されるポートグループでは本設定を承諾に設定する必要があります。</p>
<ul>
<li><a href="https://docs.vmware.com/jp/VMware-vSphere/7.0/com.vmware.vsphere.security.doc/GUID-7DC6486F-5400-44DF-8A62-6273798A2F80.html">偽装転送</a></li>
</ul>
<p>また、ESXi の仮想スイッチは一般的な L2 スイッチと異なり、vNIC の MAC アドレスを見てフォワーディングを行います。スイッチでの MAC アドレスのラーニングは行わないため、Nested ESXi の vNIC と異なる宛先 MAC アドレスのフレームは Nested ESXi へフォワーディングしません。</p>
<p>このため、以下の無差別モード (プロミスキャスモード) を &ldquo;承諾&rdquo; に設定し、仮想スイッチに到達したフレームすべてを仮想マシンが受信できるようにします。一般的にはパケットキャプチャなどを行う場合にプロミスキャスモードを使用します。</p>
<ul>
<li><a href="https://docs.vmware.com/en/VMware-vSphere/7.0/com.vmware.vsphere.security.doc/GUID-92F3AB1F-B4C5-4F25-A010-8820D7250350.html">無差別モード操作</a></li>
</ul>
<p>標準スイッチの構成では標準スイッチかポートグループ、分散スイッチの構成では分散ポートグループか分散ポートで設定をおこないます。</p>
<ul>
<li><a href="https://docs.vmware.com/jp/VMware-vSphere/7.0/com.vmware.vsphere.networking.doc/GUID-5D367C45-7650-4636-B2F4-590EDF9E9176.html">vSphere 標準スイッチまたは vSphere Distributed Switch でのネットワーク ポリシーの適用</a></li>
<li><a href="https://docs.vmware.com/jp/VMware-vSphere/7.0/com.vmware.vsphere.networking.doc/GUID-62914CF2-A6A8-4DCC-90A9-8CD4BBF50017.html">セキュリティ ポリシー</a></li>
</ul>
<p>これらのセキュリティポリシーを &ldquo;承諾&rdquo; にする場合の注意点として、本来は不正なフレームも破棄しなくなってしまうので、MAC アドレスのなりすましなどに対して脆弱になります。加えて、プロミスキャスモードは vNIC がすべてのフレームを受信するようになるため、トラフィック量によっては性能問題が出る場合もあります。</p>
<ul>
<li><a href="https://www.virtuallyghetto.com/2013/11/why-is-promiscuous-mode-forged.html">Why is Promiscuous Mode &amp; Forged Transmits required for Nested ESXi?</a></li>
<li><a href="https://anthonyspiteri.net/nested-esxi-reduced-network-throughput-with-promiscuous-mode-portgroups/">Nested ESXi – Reduced Network Throughput with Promiscuous Mode PortGroups</a></li>
</ul>
<h3 id="偽装転送を許可-vds-66-以降の-mac-ラーニングを使う">偽装転送を許可＆ vDS 6.6 以降の MAC ラーニングを使う</h3>
<p>vSphere 6.7 では vDS 6.6 に MAC ラーニングが実装され、分散スイッチが仮想マシンの MAC アドレスを学習できるようもになりました。これにより、プロミスキャスモードが無効の場合でも宛先 MAC アドレスが vNIC と異なるフレームを正しい vNIC にフォワーディング出来るようになっています(偽装転送は承諾が必須)。</p>
<p><a href="https://www.virtuallyghetto.com/2018/04/native-mac-learning-in-vsphere-6-7-removes-the-need-for-promiscuous-mode-for-nested-esxi.html">Native MAC Learning in vSphere 6.7 removes the need for Promiscuous mode for Nested ESXi</a></p>
<p>なお、設定変更は中の人の記事からリンクされている PowerCLI スクリプトの Get-MacLearn / Set-MacLearn を使うか、vSphere Web Services API を直接叩くことで実施できます。GUI からは有効に出来ないようです。色々な理由で個人的に本機能を試せる機会がなく実績を持っていないため、是非どなたか検証して結果を公開していただけるとありがたいです。</p>
<h2 id="おわりに">おわりに</h2>
<p>今回は Nested ESXi に必要な設定とその詳細について見ていきました。Nested ESXi 一つ取っても非常に様々な vSphere のテクニックが使用されていることが分かります。中の人の Nested ESXi Appliance はこれらの設定が一通り事前に施してあるのでデプロイするだけで済み、とてもありがたみを感じることが出来ると思います。</p>
<p>また、非常に特殊な設定もいくつかはありますが、基本的には物理環境でも元々は何らかのユースケースが存在する機能が転用されています。これらの個々の機能を理解しておくと、物理環境でも設計やトラブルシューティングに応用を効かせることが出来ます。是非、興味のある方は個々の機能のドキュメントなどを読んでより一層 vSphere に Deep Dive してみてもらえればと思います。</p>

    </div><div class="post_comments">
  
  
  
  
</div>




  </article>
<aside class="sidebar">
  <section class="sidebar_inner">
    <br>
    


    
    <h2 class="mt-4">Recent Posts</h2>
    <ul class="flex-column">
      <li>
        <a href="http://localhost:1313/post/2025-07-17/" class="nav-link" title="VCF Installer に Offline Depot 用の CA 証明書を API でインポートする">VCF Installer に Offline Depot 用の CA 証明書を API でインポートする</a>
      </li>
      <li>
        <a href="http://localhost:1313/post/2025-05-11/" class="nav-link" title="【備忘録】TKG 2.5.2 用の Linux カスタムイメージのビルドで引っかかった箇所のメモ書き">【備忘録】TKG 2.5.2 用の Linux カスタムイメージのビルドで引っかかった箇所のメモ書き</a>
      </li>
      <li>
        <a href="http://localhost:1313/post/2025-04-29/" class="nav-link" title="【備忘録】vsphere-csi-provider と TKG 2.x のサポート期間のドキュメント">【備忘録】vsphere-csi-provider と TKG 2.x のサポート期間のドキュメント</a>
      </li>
      <li>
        <a href="http://localhost:1313/post/2023-06-18/" class="nav-link" title="VMware Skyline Health Diagnostics を vSphere Client プラグインとして使用する">VMware Skyline Health Diagnostics を vSphere Client プラグインとして使用する</a>
      </li>
      <li>
        <a href="http://localhost:1313/post/2023-02-04/" class="nav-link" title="PowerCLI で vCenter Server 管理下の ESXi の NTP 設定を一括変更">PowerCLI で vCenter Server 管理下の ESXi の NTP 設定を一括変更</a>
      </li>
      <li>
        <a href="http://localhost:1313/post/2022-12-09/" class="nav-link" title="PowerCLI で vCenter Server のトリガー済みアラームを取得">PowerCLI で vCenter Server のトリガー済みアラームを取得</a>
      </li>
      <li>
        <a href="http://localhost:1313/post/2022-12-08_2/" class="nav-link" title="【後編】Sandbox による ESXi の保護: Daemon Sandboxing in ESXi 8.0">【後編】Sandbox による ESXi の保護: Daemon Sandboxing in ESXi 8.0</a>
      </li>
      <li>
        <a href="http://localhost:1313/post/2022-12-08_1/" class="nav-link" title="【前編】Sandbox による ESXi の保護: VM Sandboxing in ESXi 6.5">【前編】Sandbox による ESXi の保護: VM Sandboxing in ESXi 6.5</a>
      </li>
    </ul>
    <div>
      <h2 class="mt-4 taxonomy" id="categories-section">Categories</h2>
      <nav class="tags_nav">
        <a href='http://localhost:1313/categories/vsphere/' class="post_tag button button_translucent" title="vsphere">
          VSPHERE
          <span class="button_tally">49</span>
        </a>
        
        <a href='http://localhost:1313/categories/kubernetes/' class="post_tag button button_translucent" title="kubernetes">
          KUBERNETES
          <span class="button_tally">2</span>
        </a>
        
        <a href='http://localhost:1313/categories/vmware-cloud-foundation/' class="post_tag button button_translucent" title="vmware cloud foundation">
          VMWARE CLOUD FOUNDATION
          <span class="button_tally">1</span>
        </a>
        
        
      </nav>
    </div>
    <div>
      <h2 class="mt-4 taxonomy" id="tags-section">Tags</h2>
      <nav class="tags_nav">
        <a href='http://localhost:1313/tags/vsphere/' class="post_tag button button_translucent" title="vsphere">
          VSPHERE
          <span class="button_tally">43</span>
        </a>
        
        <a href='http://localhost:1313/tags/esxi/' class="post_tag button button_translucent" title="esxi">
          ESXI
          <span class="button_tally">27</span>
        </a>
        
        <a href='http://localhost:1313/tags/tips/' class="post_tag button button_translucent" title="tips">
          TIPS
          <span class="button_tally">22</span>
        </a>
        
        <a href='http://localhost:1313/tags/vcenter-server/' class="post_tag button button_translucent" title="vcenter server">
          VCENTER SERVER
          <span class="button_tally">20</span>
        </a>
        
        <a href='http://localhost:1313/tags/security/' class="post_tag button button_translucent" title="security">
          SECURITY
          <span class="button_tally">12</span>
        </a>
        
        <a href='http://localhost:1313/tags/vsphere-7.0/' class="post_tag button button_translucent" title="vsphere 7.0">
          VSPHERE 7.0
          <span class="button_tally">10</span>
        </a>
        
        <a href='http://localhost:1313/tags/troubleshooting/' class="post_tag button button_translucent" title="troubleshooting">
          TROUBLESHOOTING
          <span class="button_tally">8</span>
        </a>
        
        <a href='http://localhost:1313/tags/architecture/' class="post_tag button button_translucent" title="architecture">
          ARCHITECTURE
          <span class="button_tally">6</span>
        </a>
        
        <a href='http://localhost:1313/tags/featured/' class="post_tag button button_translucent" title="featured">
          FEATURED
          <span class="button_tally">4</span>
        </a>
        
        <a href='http://localhost:1313/tags/network/' class="post_tag button button_translucent" title="network">
          NETWORK
          <span class="button_tally">4</span>
        </a>
        
        <a href='http://localhost:1313/tags/cli/' class="post_tag button button_translucent" title="cli">
          CLI
          <span class="button_tally">3</span>
        </a>
        
        <a href='http://localhost:1313/tags/monitoring/' class="post_tag button button_translucent" title="monitoring">
          MONITORING
          <span class="button_tally">3</span>
        </a>
        
        <a href='http://localhost:1313/tags/nested/' class="post_tag button button_translucent" title="nested">
          NESTED
          <span class="button_tally">3</span>
        </a>
        
        <a href='http://localhost:1313/tags/esxi-on-arm/' class="post_tag button button_translucent" title="esxi on arm">
          ESXI ON ARM
          <span class="button_tally">2</span>
        </a>
        
        <a href='http://localhost:1313/tags/tanzu-kubernetes-grid/' class="post_tag button button_translucent" title="tanzu kubernetes grid">
          TANZU KUBERNETES GRID
          <span class="button_tally">2</span>
        </a>
        
        <a href='http://localhost:1313/tags/vmware-cloud-foundation/' class="post_tag button button_translucent" title="vmware cloud foundation">
          VMWARE CLOUD FOUNDATION
          <span class="button_tally">2</span>
        </a>
        
        <a href='http://localhost:1313/tags/vsan/' class="post_tag button button_translucent" title="vsan">
          VSAN
          <span class="button_tally">2</span>
        </a>
        
        <a href='http://localhost:1313/tags/arm/' class="post_tag button button_translucent" title="arm">
          ARM
          <span class="button_tally">1</span>
        </a>
        
        <a href='http://localhost:1313/tags/backup-and-restore/' class="post_tag button button_translucent" title="backup and restore">
          BACKUP AND RESTORE
          <span class="button_tally">1</span>
        </a>
        
        <a href='http://localhost:1313/tags/centos/' class="post_tag button button_translucent" title="centos">
          CENTOS
          <span class="button_tally">1</span>
        </a>
        
        <a href='http://localhost:1313/tags/driver/' class="post_tag button button_translucent" title="driver">
          DRIVER
          <span class="button_tally">1</span>
        </a>
        
        <a href='http://localhost:1313/tags/event/' class="post_tag button button_translucent" title="event">
          EVENT
          <span class="button_tally">1</span>
        </a>
        
        <a href='http://localhost:1313/tags/fedora/' class="post_tag button button_translucent" title="fedora">
          FEDORA
          <span class="button_tally">1</span>
        </a>
        
        <a href='http://localhost:1313/tags/hardware/' class="post_tag button button_translucent" title="hardware">
          HARDWARE
          <span class="button_tally">1</span>
        </a>
        
        <a href='http://localhost:1313/tags/installation/' class="post_tag button button_translucent" title="installation">
          INSTALLATION
          <span class="button_tally">1</span>
        </a>
        
        <a href='http://localhost:1313/tags/instant-clone/' class="post_tag button button_translucent" title="instant clone">
          INSTANT CLONE
          <span class="button_tally">1</span>
        </a>
        
        <a href='http://localhost:1313/tags/linux/' class="post_tag button button_translucent" title="linux">
          LINUX
          <span class="button_tally">1</span>
        </a>
        
        <a href='http://localhost:1313/tags/management/' class="post_tag button button_translucent" title="management">
          MANAGEMENT
          <span class="button_tally">1</span>
        </a>
        
        <a href='http://localhost:1313/tags/memory/' class="post_tag button button_translucent" title="memory">
          MEMORY
          <span class="button_tally">1</span>
        </a>
        
        <a href='http://localhost:1313/tags/raspberry-pi/' class="post_tag button button_translucent" title="raspberry pi">
          RASPBERRY PI
          <span class="button_tally">1</span>
        </a>
        
        <a href='http://localhost:1313/tags/resource-management/' class="post_tag button button_translucent" title="resource management">
          RESOURCE MANAGEMENT
          <span class="button_tally">1</span>
        </a>
        
        <a href='http://localhost:1313/tags/sdk/api/' class="post_tag button button_translucent" title="sdk/api">
          SDK/API
          <span class="button_tally">1</span>
        </a>
        
        <a href='http://localhost:1313/tags/storage/' class="post_tag button button_translucent" title="storage">
          STORAGE
          <span class="button_tally">1</span>
        </a>
        
        <a href='http://localhost:1313/tags/vcf-installer/' class="post_tag button button_translucent" title="vcf installer">
          VCF INSTALLER
          <span class="button_tally">1</span>
        </a>
        
        <a href='http://localhost:1313/tags/vmware-tools/' class="post_tag button button_translucent" title="vmware tools">
          VMWARE TOOLS
          <span class="button_tally">1</span>
        </a>
        
        <a href='http://localhost:1313/tags/vmware-workstation/' class="post_tag button button_translucent" title="vmware workstation">
          VMWARE WORKSTATION
          <span class="button_tally">1</span>
        </a>
        
        <a href='http://localhost:1313/tags/vrealize-automation/' class="post_tag button button_translucent" title="vrealize automation">
          VREALIZE AUTOMATION
          <span class="button_tally">1</span>
        </a>
        
        <a href='http://localhost:1313/tags/vsphere-container-plug-in/' class="post_tag button button_translucent" title="vsphere container plug-in">
          VSPHERE CONTAINER PLUG-IN
          <span class="button_tally">1</span>
        </a>
        
        <a href='http://localhost:1313/tags/vulnerability/' class="post_tag button button_translucent" title="vulnerability">
          VULNERABILITY
          <span class="button_tally">1</span>
        </a>
        
        <a href='http://localhost:1313/tags/x86/' class="post_tag button button_translucent" title="x86">
          X86
          <span class="button_tally">1</span>
        </a>
        
        
      </nav>
    </div>
  </section>
</aside>

  
</div>
    </main><svg width="0" height="0" class="hidden">
  <symbol viewBox="0 0 512 512" xmlns="http://www.w3.org/2000/svg" id="facebook">
    <path d="M437 0H75C33.648 0 0 33.648 0 75v362c0 41.352 33.648 75 75 75h151V331h-60v-90h60v-61c0-49.629 40.371-90 90-90h91v90h-91v61h91l-15 90h-76v181h121c41.352 0 75-33.648 75-75V75c0-41.352-33.648-75-75-75zm0 0"></path>
  </symbol>
  <symbol xmlns="http://www.w3.org/2000/svg" viewBox="0 0 18.001 18.001" id="twitter">
    <path d="M15.891 4.013c.808-.496 1.343-1.173 1.605-2.034a8.68 8.68 0 0 1-2.351.861c-.703-.756-1.593-1.14-2.66-1.14-1.043 0-1.924.366-2.643 1.078a3.56 3.56 0 0 0-1.076 2.605c0 .309.039.585.117.819-3.076-.105-5.622-1.381-7.628-3.837-.34.601-.51 1.213-.51 1.846 0 1.301.549 2.332 1.645 3.089-.625-.053-1.176-.211-1.645-.47 0 .929.273 1.705.82 2.388a3.623 3.623 0 0 0 2.115 1.291c-.312.08-.641.118-.979.118-.312 0-.533-.026-.664-.083.23.757.664 1.371 1.291 1.841a3.652 3.652 0 0 0 2.152.743C4.148 14.173 2.625 14.69.902 14.69c-.422 0-.721-.006-.902-.038 1.697 1.102 3.586 1.649 5.676 1.649 2.139 0 4.029-.542 5.674-1.626 1.645-1.078 2.859-2.408 3.639-3.974a10.77 10.77 0 0 0 1.172-4.892v-.468a7.788 7.788 0 0 0 1.84-1.921 8.142 8.142 0 0 1-2.11.593z"
      ></path>
  </symbol>
  <symbol aria-hidden="true" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 512 512" id="mail">
    <path  d="M502.3 190.8c3.9-3.1 9.7-.2 9.7 4.7V400c0 26.5-21.5 48-48 48H48c-26.5 0-48-21.5-48-48V195.6c0-5 5.7-7.8 9.7-4.7 22.4 17.4 52.1 39.5 154.1 113.6 21.1 15.4 56.7 47.8 92.2 47.6 35.7.3 72-32.8 92.3-47.6 102-74.1 131.6-96.3 154-113.7zM256 320c23.2.4 56.6-29.2 73.4-41.4 132.7-96.3 142.8-104.7 173.4-128.7 5.8-4.5 9.2-11.5 9.2-18.9v-19c0-26.5-21.5-48-48-48H48C21.5 64 0 85.5 0 112v19c0 7.4 3.4 14.3 9.2 18.9 30.6 23.9 40.7 32.4 173.4 128.7 16.8 12.2 50.2 41.8 73.4 41.4z"></path>
  </symbol>
  <symbol xmlns="http://www.w3.org/2000/svg" viewBox="0 0 512 512" id="calendar">
    <path d="M452 40h-24V0h-40v40H124V0H84v40H60C26.916 40 0 66.916 0 100v352c0 33.084 26.916 60 60 60h392c33.084 0 60-26.916 60-60V100c0-33.084-26.916-60-60-60zm20 412c0 11.028-8.972 20-20 20H60c-11.028 0-20-8.972-20-20V188h432v264zm0-304H40v-48c0-11.028 8.972-20 20-20h24v40h40V80h264v40h40V80h24c11.028 0 20 8.972 20 20v48z"></path>
    <path d="M76 230h40v40H76zm80 0h40v40h-40zm80 0h40v40h-40zm80 0h40v40h-40zm80 0h40v40h-40zM76 310h40v40H76zm80 0h40v40h-40zm80 0h40v40h-40zm80 0h40v40h-40zM76 390h40v40H76zm80 0h40v40h-40zm80 0h40v40h-40zm80 0h40v40h-40zm80-80h40v40h-40z"></path>
  </symbol>
  <symbol xmlns="http://www.w3.org/2000/svg" viewBox="0 0 512 512" id="github">
    <path d="M255.968 5.329C114.624 5.329 0 120.401 0 262.353c0 113.536 73.344 209.856 175.104 243.872 12.8 2.368 17.472-5.568 17.472-12.384 0-6.112-.224-22.272-.352-43.712-71.2 15.52-86.24-34.464-86.24-34.464-11.616-29.696-28.416-37.6-28.416-37.6-23.264-15.936 1.728-15.616 1.728-15.616 25.696 1.824 39.2 26.496 39.2 26.496 22.848 39.264 59.936 27.936 74.528 21.344 2.304-16.608 8.928-27.936 16.256-34.368-56.832-6.496-116.608-28.544-116.608-127.008 0-28.064 9.984-51.008 26.368-68.992-2.656-6.496-11.424-32.64 2.496-68 0 0 21.504-6.912 70.4 26.336 20.416-5.696 42.304-8.544 64.096-8.64 21.728.128 43.648 2.944 64.096 8.672 48.864-33.248 70.336-26.336 70.336-26.336 13.952 35.392 5.184 61.504 2.56 68 16.416 17.984 26.304 40.928 26.304 68.992 0 98.72-59.84 120.448-116.864 126.816 9.184 7.936 17.376 23.616 17.376 47.584 0 34.368-.32 62.08-.32 70.496 0 6.88 4.608 14.88 17.6 12.352C438.72 472.145 512 375.857 512 262.353 512 120.401 397.376 5.329 255.968 5.329z"></path>
  </symbol>
  <symbol xmlns="http://www.w3.org/2000/svg" viewBox="0 0 212 212" id="gitlab">
    <path d="M12.3 74.7h54L43.3 3c-1-3.6-6.4-3.6-7.6 0L12.3 74.8z" />
    <path d="M12.3 74.7L.5 111c-1 3.2 0 6.8 3 8.8l101.6 74-92.5-119z"/>
    <path d="M105 193.7l-38.6-119h-54l92.7 119z"/>
    <path d="M105 193.7l38.7-119H66.4l38.7 119z"/>
    <path d="M105 193.7l38.7-119H198l-93 119z"/>
    <path d="M198 74.7l11.6 36.2c1 3 0 6.6-3 8.6l-101.5 74 93-119z"/>
    <path d="M198 74.7h-54.3L167 3c1.2-3.6 6.4-3.6 7.6 0L198 74.8z"/>
  </symbol>
  <symbol viewBox="0 0 24 24" xmlns="http://www.w3.org/2000/svg" id="rss">
    <circle cx="3.429" cy="20.571" r="3.429"></circle>
    <path d="M11.429 24h4.57C15.999 15.179 8.821 8.001 0 8v4.572c6.302.001 11.429 5.126 11.429 11.428z"></path>
    <path d="M24 24C24 10.766 13.234 0 0 0v4.571c10.714 0 19.43 8.714 19.43 19.429z"></path>
  </symbol>
  <symbol viewBox="0 0 512 512" xmlns="http://www.w3.org/2000/svg" id="linkedin">
    <path d="M437 0H75C33.648 0 0 33.648 0 75v362c0 41.352 33.648 75 75 75h362c41.352 0 75-33.648 75-75V75c0-41.352-33.648-75-75-75zM181 406h-60V196h60zm0-240h-60v-60h60zm210 240h-60V286c0-16.54-13.46-30-30-30s-30 13.46-30 30v120h-60V196h60v11.309C286.719 202.422 296.93 196 316 196c40.691.043 75 36.547 75 79.688zm0 0"></path>
  </symbol>
  <symbol xmlns="http://www.w3.org/2000/svg" viewBox="0 0 612 612" id="to-top">
    <path d="M604.501 440.509L325.398 134.956c-5.331-5.357-12.423-7.627-19.386-7.27-6.989-.357-14.056 1.913-19.387 7.27L7.499 440.509c-9.999 10.024-9.999 26.298 0 36.323s26.223 10.024 36.222 0l262.293-287.164L568.28 476.832c9.999 10.024 26.222 10.024 36.221 0 9.999-10.023 9.999-26.298 0-36.323z"></path>
  </symbol>
  <symbol viewBox="0 0 512 512" xmlns="http://www.w3.org/2000/svg" id="carly">
    <path d="M504.971 239.029L448 182.059V84c0-46.317-37.682-84-84-84h-44c-13.255 0-24 10.745-24 24s10.745 24 24 24h44c19.851 0 36 16.149 36 36v108c0 6.365 2.529 12.47 7.029 16.971L454.059 256l-47.029 47.029A24.002 24.002 0 0 0 400 320v108c0 19.851-16.149 36-36 36h-44c-13.255 0-24 10.745-24 24s10.745 24 24 24h44c46.318 0 84-37.683 84-84v-98.059l56.971-56.971c9.372-9.372 9.372-24.568 0-33.941zM112 192V84c0-19.851 16.149-36 36-36h44c13.255 0 24-10.745 24-24S205.255 0 192 0h-44c-46.318 0-84 37.683-84 84v98.059l-56.971 56.97c-9.373 9.373-9.373 24.568 0 33.941L64 329.941V428c0 46.317 37.682 84 84 84h44c13.255 0 24-10.745 24-24s-10.745-24-24-24h-44c-19.851 0-36-16.149-36-36V320c0-6.365-2.529-12.47-7.029-16.971L57.941 256l47.029-47.029A24.002 24.002 0 0 0 112 192z"></path>
  </symbol>
  <symbol viewBox="0 0 24 24" xmlns="http://www.w3.org/2000/svg" id="copy">
    <path d="M23 2.75A2.75 2.75 0 0 0 20.25 0H8.75A2.75 2.75 0 0 0 6 2.75v13.5A2.75 2.75 0 0 0 8.75 19h11.5A2.75 2.75 0 0 0 23 16.25zM18.25 14.5h-7.5a.75.75 0 0 1 0-1.5h7.5a.75.75 0 0 1 0 1.5zm0-3h-7.5a.75.75 0 0 1 0-1.5h7.5a.75.75 0 0 1 0 1.5zm0-3h-7.5a.75.75 0 0 1 0-1.5h7.5a.75.75 0 0 1 0 1.5z"></path>
    <path d="M8.75 20.5a4.255 4.255 0 0 1-4.25-4.25V2.75c0-.086.02-.166.025-.25H3.75A2.752 2.752 0 0 0 1 5.25v16A2.752 2.752 0 0 0 3.75 24h12a2.752 2.752 0 0 0 2.75-2.75v-.75z"></path>
  </symbol>
  <symbol xmlns="http://www.w3.org/2000/svg" viewBox="0 0 512.001 512.001" id="closeme">
    <path d="M284.286 256.002L506.143 34.144c7.811-7.811 7.811-20.475 0-28.285-7.811-7.81-20.475-7.811-28.285 0L256 227.717 34.143 5.859c-7.811-7.811-20.475-7.811-28.285 0-7.81 7.811-7.811 20.475 0 28.285l221.857 221.857L5.858 477.859c-7.811 7.811-7.811 20.475 0 28.285a19.938 19.938 0 0 0 14.143 5.857 19.94 19.94 0 0 0 14.143-5.857L256 284.287l221.857 221.857c3.905 3.905 9.024 5.857 14.143 5.857s10.237-1.952 14.143-5.857c7.811-7.811 7.811-20.475 0-28.285L284.286 256.002z"></path>
  </symbol>
  <symbol xmlns="http://www.w3.org/2000/svg" viewBox="0 0 512 512" id="open-menu">
    <path d="M492 236H20c-11.046 0-20 8.954-20 20s8.954 20 20 20h472c11.046 0 20-8.954 20-20s-8.954-20-20-20zm0-160H20C8.954 76 0 84.954 0 96s8.954 20 20 20h472c11.046 0 20-8.954 20-20s-8.954-20-20-20zm0 320H20c-11.046 0-20 8.954-20 20s8.954 20 20 20h472c11.046 0 20-8.954 20-20s-8.954-20-20-20z"></path>
  </symbol>
  <symbol xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" id="instagram">
    <path d="M12 2.163c3.204 0 3.584.012 4.85.07 3.252.148 4.771 1.691 4.919 4.919.058 1.265.069 1.645.069 4.849 0 3.205-.012 3.584-.069 4.849-.149 3.225-1.664 4.771-4.919 4.919-1.266.058-1.644.07-4.85.07-3.204 0-3.584-.012-4.849-.07-3.26-.149-4.771-1.699-4.919-4.92-.058-1.265-.07-1.644-.07-4.849 0-3.204.013-3.583.07-4.849.149-3.227 1.664-4.771 4.919-4.919 1.266-.057 1.645-.069 4.849-.069zm0-2.163c-3.259 0-3.667.014-4.947.072-4.358.2-6.78 2.618-6.98 6.98-.059 1.281-.073 1.689-.073 4.948 0 3.259.014 3.668.072 4.948.2 4.358 2.618 6.78 6.98 6.98 1.281.058 1.689.072 4.948.072 3.259 0 3.668-.014 4.948-.072 4.354-.2 6.782-2.618 6.979-6.98.059-1.28.073-1.689.073-4.948 0-3.259-.014-3.667-.072-4.947-.196-4.354-2.617-6.78-6.979-6.98-1.281-.059-1.69-.073-4.949-.073zm0 5.838c-3.403 0-6.162 2.759-6.162 6.162s2.759 6.163 6.162 6.163 6.162-2.759 6.162-6.163c0-3.403-2.759-6.162-6.162-6.162zm0 10.162c-2.209 0-4-1.79-4-4 0-2.209 1.791-4 4-4s4 1.791 4 4c0 2.21-1.791 4-4 4zm6.406-11.845c-.796 0-1.441.645-1.441 1.44s.645 1.44 1.441 1.44c.795 0 1.439-.645 1.439-1.44s-.644-1.44-1.439-1.44z"/>
  </symbol>
  <symbol xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" id=youtube>
    <path d="M19.615 3.184c-3.604-.246-11.631-.245-15.23 0-3.897.266-4.356 2.62-4.385 8.816.029 6.185.484 8.549 4.385 8.816 3.6.245 11.626.246 15.23 0 3.897-.266 4.356-2.62 4.385-8.816-.029-6.185-.484-8.549-4.385-8.816zm-10.615 12.816v-8l8 3.993-8 4.007z"/>
  </symbol>
  <symbol xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" id="stackoverflow">
    <path d="M21 27v-8h3v11H0V19h3v8h18z"></path><path d="M17.1.2L15 1.8l7.9 10.6 2.1-1.6L17.1.2zm3.7 14.7L10.6 6.4l1.7-2 10.2 8.5-1.7 2zM7.2 12.3l12 5.6 1.1-2.4-12-5.6-1.1 2.4zm-1.8 6.8l13.56 1.96.17-2.38-13.26-2.55-.47 2.97zM19 25H5v-3h14v3z"></path>
  </symbol>
  <symbol xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" id="xing">
    <path d="M18.188 0c-.517 0-.741.325-.927.66 0 0-7.455 13.224-7.702 13.657.015.024 4.919 9.023 4.919 9.023.17.308.436.66.967.66h3.454c.211 0 .375-.078.463-.22.089-.151.089-.346-.009-.536l-4.879-8.916c-.004-.006-.004-.016 0-.022L22.139.756c.095-.191.097-.387.006-.535C22.056.078 21.894 0 21.686 0h-3.498zM3.648 4.74c-.211 0-.385.074-.473.216-.09.149-.078.339.02.531l2.34 4.05c.004.01.004.016 0 .021L1.86 16.051c-.099.188-.093.381 0 .529.085.142.239.234.45.234h3.461c.518 0 .766-.348.945-.667l3.734-6.609-2.378-4.155c-.172-.315-.434-.659-.962-.659H3.648v.016z"/>
  </symbol>
  <symbol xmlns="http://www.w3.org/2000/svg" viewBox="0 0 71 55" id="discord">
    <path d="M60.1045 4.8978C55.5792 2.8214 50.7265 1.2916 45.6527 0.41542C45.5603 0.39851 45.468 0.440769 45.4204 0.525289C44.7963 1.6353 44.105 3.0834 43.6209 4.2216C38.1637 3.4046 32.7345 3.4046 27.3892 4.2216C26.905 3.0581 26.1886 1.6353 25.5617 0.525289C25.5141 0.443589 25.4218 0.40133 25.3294 0.41542C20.2584 1.2888 15.4057 2.8186 10.8776 4.8978C10.8384 4.9147 10.8048 4.9429 10.7825 4.9795C1.57795 18.7309 -0.943561 32.1443 0.293408 45.3914C0.299005 45.4562 0.335386 45.5182 0.385761 45.5576C6.45866 50.0174 12.3413 52.7249 18.1147 54.5195C18.2071 54.5477 18.305 54.5139 18.3638 54.4378C19.7295 52.5728 20.9469 50.6063 21.9907 48.5383C22.0523 48.4172 21.9935 48.2735 21.8676 48.2256C19.9366 47.4931 18.0979 46.6 16.3292 45.5858C16.1893 45.5041 16.1781 45.304 16.3068 45.2082C16.679 44.9293 17.0513 44.6391 17.4067 44.3461C17.471 44.2926 17.5606 44.2813 17.6362 44.3151C29.2558 49.6202 41.8354 49.6202 53.3179 44.3151C53.3935 44.2785 53.4831 44.2898 53.5502 44.3433C53.9057 44.6363 54.2779 44.9293 54.6529 45.2082C54.7816 45.304 54.7732 45.5041 54.6333 45.5858C52.8646 46.6197 51.0259 47.4931 49.0921 48.2228C48.9662 48.2707 48.9102 48.4172 48.9718 48.5383C50.038 50.6034 51.2554 52.5699 52.5959 54.435C52.6519 54.5139 52.7526 54.5477 52.845 54.5195C58.6464 52.7249 64.529 50.0174 70.6019 45.5576C70.6551 45.5182 70.6887 45.459 70.6943 45.3942C72.1747 30.0791 68.2147 16.7757 60.1968 4.9823C60.1772 4.9429 60.1437 4.9147 60.1045 4.8978ZM23.7259 37.3253C20.2276 37.3253 17.3451 34.1136 17.3451 30.1693C17.3451 26.225 20.1717 23.0133 23.7259 23.0133C27.308 23.0133 30.1626 26.2532 30.1066 30.1693C30.1066 34.1136 27.28 37.3253 23.7259 37.3253ZM47.3178 37.3253C43.8196 37.3253 40.9371 34.1136 40.9371 30.1693C40.9371 26.225 43.7636 23.0133 47.3178 23.0133C50.9 23.0133 53.7545 26.2532 53.6986 30.1693C53.6986 34.1136 50.9 37.3253 47.3178 37.3253Z"/>
  </symbol>
  <symbol xmlns="http://www.w3.org/2000/svg" viewBox="0 0 17 18" id="mastodon">
    <path
    fill="#ffffff"
    d="m 15.054695,9.8859583 c -0.22611,1.1632697 -2.02517,2.4363497 -4.09138,2.6830797 -1.0774504,0.12856 -2.1382704,0.24673 -3.2694704,0.19484 -1.84996,-0.0848 -3.30971,-0.44157 -3.30971,-0.44157 0,0.1801 0.0111,0.35157 0.0333,0.51194 0.24051,1.82571 1.81034,1.93508 3.29737,1.98607 1.50088,0.0514 2.8373104,-0.37004 2.8373104,-0.37004 l 0.0617,1.35686 c 0,0 -1.0498104,0.56374 -2.9199404,0.66742 -1.03124,0.0567 -2.3117,-0.0259 -3.80308,-0.42069 -3.23454998,-0.85613 -3.79081998,-4.304 -3.87592998,-7.8024197 -0.026,-1.03871 -0.01,-2.01815 -0.01,-2.83732 0,-3.57732 2.34385998,-4.62587996 2.34385998,-4.62587996 1.18184,-0.54277 3.20976,-0.77101 5.318,-0.7882499985409 h 0.0518 C 9.8267646,0.01719834 11.856025,0.24547834 13.037775,0.78824834 c 0,0 2.34377,1.04855996 2.34377,4.62587996 0,0 0.0294,2.63937 -0.32687,4.47183"/>
 <path
    fill="#000000"
    d="m 12.616925,5.6916583 v 4.3315297 h -1.71607 V 5.8189683 c 0,-0.88624 -0.37289,-1.33607 -1.1187604,-1.33607 -0.82467,0 -1.23799,0.53361 -1.23799,1.58875 v 2.30122 h -1.70594 v -2.30122 c 0,-1.05514 -0.4134,-1.58875 -1.23808,-1.58875 -0.74587,0 -1.11876,0.44983 -1.11876,1.33607 v 4.2042197 h -1.71607 V 5.6916583 c 0,-0.88527 0.22541,-1.58876 0.67817,-2.10922 0.46689,-0.52047 1.07833,-0.78727 1.83735,-0.78727 0.87816,0 1.54317,0.33752 1.98288,1.01267 l 0.42744,0.71655 0.42753,-0.71655 c 0.43961,-0.67515 1.10463,-1.01267 1.9828704,-1.01267 0.75893,0 1.37037,0.2668 1.83735,0.78727 0.45268,0.52046 0.67808,1.22395 0.67808,2.10922"/>
  </symbol>
  <symbol xmlns="http://www.w3.org/2000/svg" viewBox="0 0 600 530" id="bluesky" >
    <path d="m135.72 44.03c66.496 49.921 138.02 151.14 164.28 205.46 26.262-54.316 97.782-155.54 164.28-205.46 47.98-36.021 125.72-63.892 125.72 24.795 0 17.712-10.155 148.79-16.111 170.07-20.703 73.984-96.144 92.854-163.25 81.433 117.3 19.964 147.14 86.092 82.697 152.22-122.39 125.59-175.91-31.511-189.63-71.766-2.514-7.3797-3.6904-10.832-3.7077-7.8964-0.0174-2.9357-1.1937 0.51669-3.7077 7.8964-13.714 40.255-67.233 197.36-189.63 71.766-64.444-66.128-34.605-132.26 82.697-152.22-67.108 11.421-142.55-7.4491-163.25-81.433-5.9562-21.282-16.111-152.36-16.111-170.07 0-88.687 77.742-60.816 125.72-24.795z"/>
  <symbol xmlns="http://www.w3.org/2000/svg" viewBox="0 0 48 48" id="ko-fi">
    <path fill="#ffffff" d="M4.5,9.8527H32.7947a0,0,0,0,1,0,0v19.225a9.07,9.07,0,0,1-9.07,9.07H13.57a9.07,9.07,0,0,1-9.07-9.07V9.8527A0,0,0,0,1,4.5,9.8527Z"/>
    <path fill="#000000" d="M12.197,25.9493l6.45,6.45,6.45-6.45a8.2,8.2,0,0,0,2.4016-5.798h0a4.5082,4.5082,0,0,0-4.212-4.5459,4.4262,4.4262,0,0,0-4.64,4.4209,4.4261,4.4261,0,0,0-4.64-4.4209,4.5082,4.5082,0,0,0-4.212,4.5459h0A8.2,8.2,0,0,0,12.197,25.9493Z"/>
    <path fill="#ffffff" d="M32.7947,9.8527H35.73a7.77,7.77,0,0,1,0,15.5394H32.7947"/>
  </svg>
  </symbol>
</svg>

<footer class="footer">
  <div class="footer_inner wrap pale">
    <img src='http://localhost:1313/icons/apple-touch-icon.png' class="icon icon_2 transparent" alt="My New Hugo Site">
    <p>Copyright&nbsp;<span class="year"></span>&nbsp;MY NEW HUGO SITE. All Rights Reserved</p><a class="to_top" href="#documentTop">
  <svg class="icon">
  <title>to-top</title>
  <use xlink:href="#to-top"></use>
</svg>

</a>

  </div>
</footer>

<script type="text/javascript" src="http://localhost:1313/en/js/bundle.84e7640170829f904da39c3d23a2c4064096bd26b37eca6f71d955e2d668377185b71761a1e9b7742b677b7bfba71d4b863f4d54a152f0bb480ab6ade26df8c8.js" integrity="sha512-hOdkAXCCn5BNo5w9I6LEBkCWvSazfspvcdlV4tZoN3GFtxdhoem3dCtne3v7px1Lhj9NVKFS8LtICrat4m34yA==" crossorigin="anonymous"></script>
  </body>
</html>
